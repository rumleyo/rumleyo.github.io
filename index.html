<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="title">CV Rumley</title>

  <!-- Préconnexion -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oWvALqw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- CSS -->
  <link rel="stylesheet" media="screen" href="main.css" />
  <link rel="stylesheet" media="print" href="print.css" />

  <style>
    /* Conteneur principal à 2 colonnes */
    #content_area {
      display: flex;
      gap: 30px;
      margin-top: 30px;
    }
    #left_col {
      flex: 0 0 30%;
      max-width: 300px;
    }
    #content_container {
      flex: 1;
      min-height: 400px;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 8px;
      border-left: 4px solid #9d4edd;
    }
    .language-selector { margin: 15px 0; text-align: right; }
    #language-select {
      padding: 8px 12px; border: 1px solid #6a0dad; border-radius: 4px;
      background: #1a1a1a; color: #fff; font-family: 'Lato', sans-serif;
    }
    .header_menu a.active { color: #9d4edd !important; font-weight: bold; }
  </style>
</head>
<body>

<div id="main_container">
	<div id="loader">
	  <p><i class="fas fa-spinner fa-spin"></i> Loading...</p>
	</div>
  <!-- HEADER -->
  <div id="header">
    <div class="header_logotype_container">
      <h1 class="logotype_name" data-i18n-html="header_name">Olivier <span class='purple'>Rumley</span></h1>
      <h2 class="logotype_occupation" data-i18n="header_job"></h2>
    </div>

    <div class="header_menu_container">
      <ul class="download_print_buttons horizontal_list">
        <li><a href="#" onclick="redirectToCompleteContent()">
          <i class="fas fa-download" ></i> <span data-i18n="download_cv">Download CV</span>
        </a></li>
      </ul>
      <div class="clear"></div>

      <div class="language-selector">
        <select id="language-select">
          <option value="en" data-i18n="lang_en">English</option>
          <option value="ja" data-i18n="lang_ja">日本語</option>
        </select>
      </div>

      <ul class="header_menu horizontal_list">
        <li><a class="no_border purple" href="#" data-content="content1.html" data-i18n="menu_profile"></a></li>
        <li><a class="no_border purple" href="#" data-content="content2.html" data-i18n="menu_education"></a></li>
        <li><a class="no_border purple" href="#" data-content="content3.html" data-i18n="menu_skills"></a></li>
        <li><a class="no_border purple" href="#" data-content="content4.html" data-i18n="menu_experience"></a></li>
        <li><a class="no_border purple" href="#" data-content="content5.html" data-i18n="menu_current"></a></li>
      </ul>
    </div>
  </div>

  <!-- === DEUX COLONNES === -->
  <div id="content_area">
    
    <!-- COLONNE GAUCHE -->
    <div id="left_col">
      <div class="profile_frame">
        <div class="profile_picture"></div>
      </div>

      <div class="hello_content">
		<h2 class="no_print" data-i18n="hello"></h2>
		<p class="print"><u data-i18n="intro_title"></u></p>
		<p data-i18n="intro_1"></p>
		<p data-i18n="intro_2"></p>
		<p data-i18n="intro_3"></p>
      </div>

      <p class="print"><u data-i18n="email_label">Email:</u> <span data-i18n="email">olivier@rumley.tokyo</span></p>
      <a class="send_message_button" href="mailto:olivier@rumley.tokyo">
        <span class="cut1"></span><span class="cut2"></span>
        <span class="content" data-i18n="send_message">Send me a message <i class="fas fa-angle-right"></i></span>
      </a>
      <br>
      <p class="print"><u data-i18n="linkedin_label">LinkedIn:</u> <span data-i18n="linkedin_url">https://www.linkedin.com/in/olivierrumley/</span></p>
      <a class="send_message_button" href="#" data-i18n-href="linkedin_url">
        <span class="cut1"></span><span class="cut2"></span>
        <span class="content" data-i18n="linkedin_text">LinkedIn <i class="fas fa-angle-right"></i></span>
      </a>
    </div>

    <!-- COLONNE DROITE -->
    <div id="content_container">
      <!-- Contenu chargé dynamiquement -->
    </div>
  </div>

  <div class="horizontal_line">
    <div class="line_left"></div>
    <div class="left_circle"></div>
    <div class="central_circle"></div>
    <div class="right_circle"></div>
    <div class="line_right"></div>
  </div>

  <div id="footer">
    <p class="footer_name" data-i18n="footer">Olivier Rumley CV 2025</p>
  </div>
</div>

<script>
  // 1. Détermine la langue immédiatement
  const urlParams = new URLSearchParams(location.search);
  const urlLang = urlParams.get('lang');
  const savedLang = localStorage.getItem('language');
  let currentLang = (urlLang && ['en', 'ja'].includes(urlLang)) ? urlLang : (savedLang || 'en');
  window.currentLang = currentLang; // ← globale

  document.documentElement.lang = currentLang;

  const contentContainer = document.getElementById('content_container');
  const langSelect = document.getElementById('language-select');
  const loader = document.getElementById('loader');
  let translations = {};

  async function loadTranslations(lang) {
    const res = await fetch(`lang/${lang}.json`, { cache: 'no-store' });
    if (!res.ok) throw new Error(`Impossible de charger lang/${lang}.json (${res.status})`);
    translations = await res.json();
  }

  function applyTranslations() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.dataset.i18n;
      if (translations[key] !== undefined) el.textContent = translations[key];
    });
    document.querySelectorAll('[data-i18n-html]').forEach(el => {
      const key = el.dataset.i18nHtml;
      if (translations[key] !== undefined) el.innerHTML = translations[key];
    });
    document.querySelectorAll('[data-i18n-href]').forEach(el => {
      const key = el.dataset.i18nHref;
      if (translations[key] !== undefined) el.href = translations[key];
    });
    if (translations.title) document.title = translations.title;
    langSelect.value = currentLang;
  }

  async function loadContent(file) {
    const folder = window.currentLang === 'ja' ? 'ja/' : 'en/';
    try {
      const res = await fetch(folder + file, { cache: 'no-store' });
      if (!res.ok) throw new Error(res.status);
      contentContainer.innerHTML = await res.text();
    } catch (e) {
      contentContainer.innerHTML = `<p style="color:#ff6b6b;">Impossible de charger ${folder}${file}</p>`;
    }
  }

  function redirectToCompleteContent() {
    location.href = `contents${window.currentLang === 'ja' ? '-ja' : ''}.html`;
  }

  // Changement de langue
  langSelect.addEventListener('change', async () => {
    const newLang = langSelect.value;
    if (newLang === window.currentLang) return;

    loader.style.display = 'flex';
    localStorage.setItem('language', newLang);
    window.currentLang = newLang;
    document.documentElement.lang = newLang;

    await loadTranslations(newLang);
    applyTranslations();

    const active = document.querySelector('.header_menu a.active') || document.querySelector('.header_menu a');
    await loadContent(active.dataset.content || 'content1.html');

    setTimeout(() => {
      loader.style.opacity = '0';
      setTimeout(() => { loader.style.display = 'none'; loader.style.opacity = '1'; }, 300);
    }, 100);
  });

  // INITIALISATION
  (async () => {
    loader.style.display = 'flex';

    try {
      await loadTranslations(currentLang);
      applyTranslations();

      const firstMenu = document.querySelector('.header_menu a');
      firstMenu.classList.add('active');
      await loadContent('content1.html');

      document.querySelectorAll('.header_menu a').forEach(link => {
        link.addEventListener('click', async e => {
          e.preventDefault();
          document.querySelectorAll('.header_menu a').forEach(a => a.classList.remove('active'));
          link.classList.add('active');
          contentContainer.innerHTML = '<p style="padding:40px;text-align:center;"><i class="fas fa-spinner fa-spin"></i></p>';
          await loadContent(link.dataset.content);
        });
      });

    } catch (e) {
      console.error(e);
      contentContainer.innerHTML = `<div style="color:#ff6b6b;padding:40px;"><h3>Erreur fatale</h3><p>${e.message}</p></div>`;
    } finally {
      setTimeout(() => {
        loader.style.opacity = '0';
        setTimeout(() => { loader.style.display = 'none'; loader.style.opacity = '1'; }, 300);
      }, 200);
    }
  })();
</script>

</body>
</html>